variables:
  ACKNOWLEDGMENT_MESSAGE: "It's always a pleasure to help, let me know if if there's anything else I can assist you with"
  CONTACT_INFORMATION: "You can email us at *info@ayanaturopathic.com* or call the clinic directly at *(207) 387-0021*"
  LINDEN_INTRODUCTION_MESSAGE: "Hi, I’m Linden, the virtual assistant for Aya Naturopathic Medicine. How can I help you today?"
  OUTPUT_MESSAGE_EMERGENCY: "If this is a medical emergency, please call 911 or go to your nearest emergency room."
  PROMPT_ANSWER_ABOUT_CONDITION: "Here's the answer to your question"
  PROMPT_VALIDATE_STATE: "Before I set you up, can I confirm what state you’re in? Our doctors currently see patients in NH, MA, CT, and ME—and Dr. Silva also sees patients in California."
  PROMPT_ASK_USER_DATA: "I'll be glad to assist you. Before we continue, who do I have the pleasure of speaking with? Could you also share your email address?"
  PROMPT_CONDITION_NOT_TREATED: "Because of the nature of your condition, one of our doctors would need to weigh in to determine whether we’re the right fit to support you. We’d love for you to email us at info@ayanaturopathic.com with a few details, and our team will let you know if scheduling a visit is appropriate.\n\n\nIf it turns out that we’re not the best match for your needs, we want to make sure you’re still supported. You can explore the American Association of Naturopathic Physicians’ Find a Doctor Directory (link) to connect with a naturopathic physician who specializes in your condition.”\n\n\nhttps://naturopathic.org/search/custom.asp?id=5613"
  PROMPT_EVENT_INFORMATION: "Here is the information about our next events"
  PROMPT_FAREWELL_MESSAGE: "It was a pleasure to assist you, see you the next time!"
  PROMPT_FRUSTRATED_CUSTOMER_OFFER_BOOK_CALL: "I’m sorry I wasn’t able to help with that"
  PROMPT_GENERAL_FAQ_QUESTION: "Here's the answer to your response"
  PROMPT_GENERATED_RESPONSE: "This is a generated response"
  PROMPT_INVALID_STATE: "It looks like you're not in a state where our doctors are currently licensed to provide care. But you can still:\n\n- Sign up for our newsletter to receive health tips, recipes, and upcoming retreat info\n- Explore the AANP Find a Doctor tool to locate a licensed naturopath in your area"
  PROMPT_OFFER_BOOK_CALL: "Would you like to schedule a free 15-minute discovery call to explore how we can help?"
  PROMPT_OFFER_NEWSLETTER: "Would you like to join our mailing list? We share helpful health tips, seasonal recipes, and clinic updates."
  PROMPT_OUT_OF_SCOPE_QUESTION: "That’s a great question. I’m not able to answer it directly, but our doctors would be happy to help. You can schedule a free 15-minute discovery call here—or reach out to our team by phone or email!"
  PROMPT_PROVIDE_CONTACT_INFO: "No worries, you can always email us at *info@ayanaturopathic.com* or call us at *(207) 387-0021*"
  PROMPT_QUESTION_IN_PERSON: "Yes! We see patients in person at Whole Life Healthcare in Newington, NH. Dr. Jeffrey is currently there on Fridays, and starting in August, both Dr. Jeffrey and Dr. Silva will offer in-person care Tuesday through Friday."
  PROMPT_QUESTION_INSURANCE: "We’re happy to talk through what’s included and how care can be structured around your goals. A great next step is to book a free 15-minute discovery call."
  PROMPT_QUESTION_PRICEY_SERVICE: "We’re happy to talk through what’s included and how care can be structured around your goals. A great next step is to book a free 15-minute discovery call."
  WELCOME_MESSAGE: "Welcome to Aya Naturopathic Medicine! Want to ask a question or explore care options?"

graph:
  id: "graph_linden"

  nodes:
    - id: "IDLE"
      decision:
        state: "IDLE"
        user_reply: "CLASSIFYING_INTENT"
    - id: "CLASSIFYING_INTENT"
      action: "use_tools"
      tools:
        - name: "classify_intent"
          type: "enum"
          options:
            - "is_emergency"
            - "is_question_about_condition"
            - "is_question_event"
            - "is_frequently_asked_question"
            - "is_out_of_scope_question"
            - "is_frustrated_needs_human"
            - "is_acknowledgment"
            - "is_potential_patient"
        - name: "is_found_on_embeddings"
          type: "boolean-flag"
      decision:
        state: "CLASSIFYING_INTENT"
        classify_intent:_is_emergency: "INVALID_REQUEST_EMERGENCY"
        classify_intent:_is_question_about_condition: "INTENT_QUESTION_CONDITION"
        classify_intent:_is_question_event: "INTENT_EVENT_QUESTION"
        classify_intent:_is_frequently_asked_question: "INTENT_FAQ"
        classify_intent:_is_out_of_scope_question: "INTENT_OUT_OF_SCOPE_QUESTION"
        classify_intent:_is_frustrated_needs_human: "INTENT_FRUSTRATED_CUSTOMER"
        classify_intent:_is_acknowledgment: "CUSTOMER_ACKNOWLEDGES_RESPONSE"
        classify_intent:_is_potential_patient: "VALIDATE_STATE"
        is_found_on_embeddings:_true: "REPLY_FROM_EMBEDDINGS"
    - id: "INVALID_REQUEST_EMERGENCY"
      action: "send_message"
      message: "$OUTPUT_MESSAGE_EMERGENCY"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
      decision:
        state: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
        user_reply: "CLASSIFYING_INTENT"
    - id: "INTENT_QUESTION_CONDITION"
      action: "use_tools"
      tools:
        - name: "is_condition_treated"
          type: "boolean-toggle"
      decision:
        state: "INTENT_QUESTION_CONDITION"
        is_condition_treated:_true: "PROVIDE_CONDITION_INFORMATION"
        is_condition_treated:_false: "CONDITION_NOT_TREATED_SEND_CONTACT_INFO"
    - id: "PROVIDE_CONDITION_INFORMATION"
      action: "send_message"
      message: "$PROMPT_ANSWER_ABOUT_CONDITION"
      next: "RECOMMENDED_DOCTOR"
    - id: "RECOMMENDED_DOCTOR"
      action: "use_special_function"
      function_name: "send_doctor_information"
      next: "VALIDATE_STATE"
    - id: "VALIDATE_STATE"
      action: "use_tools"
      tools:
        - name: "is_valid_state"
          type: "boolean-toggle"
      decision:
        state: "VALIDATE_STATE"
        is_valid_state:_false: "CUSTOMER_IN_NON_VALID_STATE"
        is_valid_state:_true: "BOOK_CALL_OFFER_ACCEPTED"
    - id: "CUSTOMER_IN_NON_VALID_STATE"
      action: "send_message"
      message: "$PROMPT_INVALID_STATE"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "BOOK_CALL_OFFER_ACCEPTED"
      action: "use_special_function"
      function_name: "send_book_call_link"
      message: "$PROMPT_OFFER_NEWSLETTER"
      decision:
        state: "BOOK_CALL_OFFER_ACCEPTED"
        user_reply: "AWAITING_NEWSLETTER_RESPONSE"
    - id: "AWAITING_NEWSLETTER_RESPONSE"
      action: "use_tools"
      tools:
        - name: "user_accepts_newsletter"
          type: "boolean-toggle"
      decision:
        state: "AWAITING_NEWSLETTER_RESPONSE"
        user_accepts_newsletter:_true: "MAILING_LIST_OFFER_ACCEPTED"
        user_accepts_newsletter:_false: "MAILING_LIST_OFFER_DECLINED"
    - id: "MAILING_LIST_OFFER_ACCEPTED"
      action: "use_special_function"
      function_name: "save_to_mailing_list"
      message: "$PROMPT_FAREWELL_MESSAGE"
      next: "FINAL"
    - id: "MAILING_LIST_OFFER_DECLINED"
      action: "send_message"
      message: "$PROMPT_FAREWELL_MESSAGE"
      next: "FINAL"
    - id: "CONDITION_NOT_TREATED_SEND_CONTACT_INFO"
      action: "send_message"
      message: "$PROMPT_CONDITION_NOT_TREATED"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "INTENT_EVENT_QUESTION"
      action: "send_message"
      message: "$PROMPT_EVENT_INFORMATION"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "INTENT_FAQ"
      action: "use_tools"
      tools:
        - name: "classify_faq"
          type: "enum"
          options:
            - "is_question_insurance"
            - "is_service_pricey"
            - "is_question_in_person"
            - "is_general_faq_question"
      decision:
        state: "INTENT_FAQ"
        classify_faq:_is_question_insurance: "ANSWER_QUESTION_INSURANCE"
        classify_faq:_is_service_pricey: "ANSWER_QUESTION_PRICEY_SERVICE"
        classify_faq:_is_question_in_person: "ANSWER_QUESTION_IN_PERSON"
        classify_faq:_is_general_faq_question: "PROVIDED_FAQ_INFORMATION"
    - id: "ANSWER_QUESTION_INSURANCE"
      action: "send_message"
      message: "$PROMPT_QUESTION_INSURANCE"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "ANSWER_QUESTION_PRICEY_SERVICE"
      action: "send_message"
      message: "$PROMPT_QUESTION_PRICEY_SERVICE"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "ANSWER_QUESTION_IN_PERSON"
      action: "send_message"
      message: "$PROMPT_QUESTION_IN_PERSON"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "PROVIDED_FAQ_INFORMATION"
      action: "send_message"
      message: "$PROMPT_GENERAL_FAQ_QUESTION"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "INTENT_OUT_OF_SCOPE_QUESTION"
      action: "send_message"
      message: "$PROMPT_OUT_OF_SCOPE_QUESTION"
      next: "OFFER_BOOK_CALL"
    - id: "OFFER_BOOK_CALL"
      action: "send_message"
      message: "$PROMPT_OFFER_BOOK_CALL"
      decision:
        state: "OFFER_BOOK_CALL"
        user_reply: "AWAITING_BOOK_CALL_OFFER_RESPONSE"
    - id: "AWAITING_BOOK_CALL_OFFER_RESPONSE"
      action: "use_tools"
      tools:
        - name: "user_accepts_book_call"
          type: "boolean-toggle"
      decision:
        state: "AWAITING_BOOK_CALL_OFFER_RESPONSE"
        user_accepts_book_call:_true: "BOOK_CALL_OFFER_ACCEPTED"
        user_accepts_book_call:_false: "BOOK_CALL_OFFER_DECLINED"
    - id: "BOOK_CALL_OFFER_DECLINED"
      action: "send_message"
      message: "$PROMPT_PROVIDE_CONTACT_INFO\n$PROMPT_OFFER_NEWSLETTER"
      decision:
        state: "BOOK_CALL_OFFER_DECLINED"
        user_reply: "AWAITING_NEWSLETTER_RESPONSE"
    - id: "INTENT_FRUSTRATED_CUSTOMER"
      action: "send_message"
      message: "$PROMPT_FRUSTRATED_CUSTOMER_OFFER_BOOK_CALL"
      next: "OFFER_BOOK_CALL"
    - id: "CUSTOMER_ACKNOWLEDGES_RESPONSE"
      action: "send_message"
      message: "$ACKNOWLEDGMENT_MESSAGE"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "REPLY_FROM_EMBEDDINGS"
      action: "use_special_function"
      function_name: "generate_response"
      message: "$PROMPT_GENERATED_RESPONSE"
      next: "REQUEST_RESOLVED_AWAIT_NEW_MESSAGE"
    - id: "FINAL"